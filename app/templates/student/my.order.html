<!DOCTYPE html>
<html>
<head>
<title>我的订单 - {part '/site.main.orgname'} - 云课 - 专业的在线学习平台</title>
<meta name="title" content="{part '/site.main.orgname'} - 我的订单 - 云课 - 专业的在线学习平台">
<meta name="keywords" content="{part '/site.main.orgname'} - 云课 - Yunke K12 在线学习 直播 云课网 在线教育">
<meta name="description" content="{part '/site.main.orgname'} - 云课(Yunke.com) -专业的K12在线学习平台。以直播授课为核心，打破时间与空间的界限，为教师高效教学、学生高效学习、家长高效管控及机构高效管理提供完美解决方案">
{part "/site.main.header"}
<script type="text/javascript" src="{utility_cdn::js('/assets_v2/js/page.js')}"></script>
</head>
<style type="text/css">
.btn_yellow_2_1{ width:90px;}
.list-tab a{ margin-right:2px;}
</style>
<body >
	{part "/site.main.nav3"}
    <!--studentPortal start-->
<section class="org-section">
    <div class="container">
      <div class="row">
        <!-- leftmenu start-->
		<div class="hidden-xs">
			{part "/user.main.menu.student.myorder"}
		</div>
        <!-- leftmenu end -->

        <!--right start-->
        <div class="right-main col-md-16 col-xs-20">
          <!--con start-->
         {* <p class="mob-nav hidden-lg hidden-md">
	          <a href="/student.main.growth" class="col-sm-3 col-xs-3">首页</a>
	          <a href="/student.course.mycourse" class="col-xs-4 col-sm-3">我的课程</a>
	          <a href="/student.order.myorder" class="col-xs-4 hidden-sm">我的订单</a>
	          <a href="/student.fav.myfav" class="col-xs-4 col-sm-3">我的收藏</a>
	          <a href="/student.discount.mydiscount" class="col-xs-5 col-sm-3">我的优惠券</a>
          </p>*}
            <div class="mainCon">
              <dl class="list-tab fs14 col-sm-12 col-xs-12 list-tab-btn-mr3">
	               <a class="col-xs-5 col-sm-3" href="/student.order.myorder/all">
	               		<dd class="col-sm-20 col-xs-20 {if($get_sta == "all")}curr{/if}">								{'全部订单'|tr:'LearningCenter'}
	               			<i></i>
	               		</dd>
	               	</a>
	               <a class="col-xs-5 col-sm-3" href="/student.order.myorder/suc">
	               		<dd class="col-sm-20 col-xs-20 {if($get_sta == "suc")}curr{/if}">								{'交易完成'|tr:'LearningCenter'}
	               			<i></i>
	               		</dd>
	               	</a>
	               <a class="col-xs-5 col-sm-3" href="/student.order.myorder/exp">
	               		<dd class="col-sm-20 col-xs-20 {if($get_sta == "exp")}curr{/if}">
		               		{'超时订单'|tr:'LearningCenter'}
		               		<i></i>
	               		</dd>
	               	</a>
	               <a class="col-xs-4 col-sm-3" href="/student.order.myorder/cal">
	               		<dd class="col-sm-20 col-xs-20 {if($get_sta == "cal")}curr{/if}">								{'已取消'|tr:'LearningCenter'}
	               			<i></i>
	               		</dd>
	               	</a>
              </dl>
              <div class="clear"></div>
              <div id="tabCon">
                <!--tc-li start-->
                <div class="tc-li">
                  <div class="litit mt20 fs14 hidden-xs hidden-sm">
                    <div class="col-md-8 col-sm-9 col-lg-11">{'课程信息'|tr:'LearningCenter'}</div>
                    <div class="col-md-4 col-sm-3 col-lg-2">{'实付金额'|tr:'LearningCenter'}</div>
                    <div class="col-md-3 col-sm-3 col-lg-2 ter">{'订单状态'|tr:'LearningCenter'}</div>
                    <div class="col-md-5 col-sm-5 col-lg-5">{'操作'|tr:'LearningCenter'}</div>
                  </div>
                  <!--orderList start-->
				  {if(!empty($order_list))}
				  {foreach($order_list as $o)}
                  <div class="orderList mt20 fs14" id="{$o->unique_order_id}">
                    <div class="col-md-9 col-xs-20  col-sm-9 col-lg-11 oltcon oltc-1">
                      <div class="col-sm-8 col-xs-10 c-fl pic">
                          <a href="{$o->course_url}">
                            <img src="{utility_cdn::file($o->course->thumb_small)}" width="100%" alt=""/>
                          {if $o->course->course_type==2}
						  <div class="g-icon3">{'录播'|tr:'LearningCenter'}</div>
                          {elseif($o->course->course_type==3)}
						  <span class="taped-icon">{'线下'|tr:'LearningCenter'}</span>
						  {/if}
                          </a>
                      </div>
                      <div class="col-sm-12 col-xs-10 c-fl oltctxt fsellip pdl0">
					  <a href="{$o->course_url}">
                        <h1>{$o->course->course_name}</h1>
                       {if(!empty($o->class))}
					   <p class="">
					   {$o->class->name|tr:'site.index'}&nbsp;&nbsp;&nbsp;&nbsp;
					   {if(!empty($o->class->teacher_real_name))}{$o->class->teacher_real_name}{else}{$o->class->teacher_name}{/if}</p>
					   {/if}
                        {if(!empty($o->class->start_time))}
						<p class="">
						{date('m',strtotime($o->class->start_time))}{'月'|tr:'LearningCenter'}{date('d',strtotime($o->class->start_time))}{'日'|tr:'LearningCenter'}
						{date('H:i',strtotime($o->class->start_time))} {'开课'|tr:'LearningCenter'}
						</p>
						{/if}
						</a>
                      </div>
                    </div>
                    <div class="col-lg-2 col-sm-3 col-md-2 col-xs-20 oltcon oltc-2 border-rt col-sm-6">
						{if !empty($o->price)}
							{if($o->price_old==0)}
								<p class="cRed">￥{$o->price/100}</p>
							{elseif($o->price_old==$o->price)}
								<p class="cRed">￥{$o->price/100}</p>
							{else}
								<p class="cGray" style="text-decoration:line-through">￥{$o->price_old/100}</p>
								<p class="cRed">￥{$o->price/100}</p>
							{/if}
						{elseif($o->price==0)}
							{if(!empty($o->price_old))}
								<p class="cGray" style="text-decoration:line-through">￥{$o->price_old/100}</p>
							{/if}
              			<p class="cGreen">{'免费'|tr:'LearningCenter'}</p>
						{else}
							{'未设置'|tr:'LearningCenter'}
						{/if}
					</div>
					{if($o->status == 'initial')}
                    <div class="col-sm-3 col-lg-2 col-md-6 oltcon oltc-3 hd-lh30">
						{$status_array[$o->status]|tr:'LearningCenter'}<script>ts('{date('i:s',strtotime($o->expiration_time)-time())}','{$o->unique_order_id}','{$o->order_id}');</script>
						<br /><em class="cYellow"></em>
					</div>
					{else}
                    <div class="col-sm-3 col-lg-2 col-md-3 hidden-xs oltcon oltc-2 hd-lh30">
						{$status_array[$o->status]|tr:'LearningCenter'}
					</div>
					{/if}
					  {if($o->status == 'initial')}
                    	<div class="col-xs-20 oltcon oltc-4 col-sm-5 col-lg-5 tec">
                      		<a class="col-sm-20 col-xs-10" href='{$o->pay_url}' target="_blank">
                      		<button class="btn_yellow_2_1">{'立即支付'|tr:'LearningCenter'}</button>
                      		</a>
                      		<p class="mt10 lh14 col-xs-10 col-sm-20"><a href="javascript:;" class="cancel" order_id="{$o->order_id}">{'取消订单'|tr:'LearningCenter'}</a></p>
                    	</div>
					  {/if}
					  {if($o->status == 'success')}
						{*<div class="col-md-3 oltcon oltc-3">
                     		<a class="btn_gray_3_1 col-sm-12 col-xs-6" value="评价" type="submit" />
                    	</div>*}
						  <div class="col-md-6 col-xs-20 oltcon oltc-2 hd-lh30 col-sm-5 col-lg-5">
						 	 {'支付成功'|tr:'LearningCenter'}
		                  </div>
					  {/if}
					  {if($o->status == 'expired')}
                    	<div class="col-sm-5 col-lg-5 col-md-6 col-xs-20 oltcon oltc-4">
                      		<a class="col-sm-20 col-xs-8 tec" href='{$o->course_url}' target="_blank">
                      			<button class="btn_yellow_2_1">{'重新购买'|tr:'LearningCenter'}</button>
                      		</a>
					        <p class="mt10 lh14 col-xs-6 col-sm-20 pad0"><a href="javascript:;"  class="delete" order_id="{$o->order_id}">{'删除订单'|tr:'LearningCenter'}</a></p>
						</div>
					  {/if}
					  {if($o->status == 'cancel')}
                    	<div class="col-md-6 col-lg-5 col-xs-20 col-sm-5  oltcon oltc-2 hd-lh30">
					 		<a href="javascript:;"  class="delete" order_id="{$o->order_id}">{'删除订单'|tr:'LearningCenter'}</a>
						</div>
					  {/if}
                    <div class="oltit">
                      <span class="col-sm-4 col-xs-7">{date('Y-m-d',strtotime($o->create_time))}</span>
                      <span class="col-xs-13 col-sm-6">{'订单'|tr:'LearningCenter'}ID：{$o->order_number}</span>
                    {if($o->pay_type)}<span class="hidden-xs col-sm-4">{'支付方式'|tr:'LearningCenter'}：{$pay_type[$o->pay_type]}</span>{/if}
                    </div>
                  </div>
				  {/foreach}
				  {else}
					  <div class="row">
					  	<div class="my-collect-no-class col-sm-20  col-xs-20 course-schedule mt15">
					       <div class="col-md-20 col-xs-20 mt15 fs14 tac" style="padding-top:60px;">
					          <img src="{utility_cdn::img('/assets_v2/img/platform/pet3.png')}" />
					          {if($get_sta == 'all')}
					          <p style="font-weight:bold;color:#666;">{'您还没有订单哦'|tr:'LearningCenter'}~!</p>
					          {elseif($get_sta == 'suc')}
					          <p style="font-weight:bold;color:#666;">{'您没有完成的订单哦'|tr:'LearningCenter'}~!</p>
					          {elseif($get_sta == 'exp')}
					          <p style="font-weight:bold;color:#666;">{'您没有超时的订单哦'|tr:'LearningCenter'}~!</p>
					          {elseif($get_sta == 'cal')}
					          <p style="font-weight:bold;color:#666;">{'您没有取消的订单哦'|tr:'LearningCenter'}~!</p>
					          {/if}
					       </div>
					    {*   {if($get_sta == 'all')}
					   		<div class="col-md-4 col-md-offset-4 mt30 fs14 tac" style="padding-bottom:60px;">
					       		<input class="btn_yellow_2"  onclick="location.href='/course.list'" value="我要购买课程" type="submit">
					   		</div>
							{/if}*}
					   </div>
		            </div>

				  {/if}
                  <!--orderList end-->

                  <!--翻页 start-->
                    <div class="col-sm-20 col-md-20 col-xs-20">
						{if(!empty($list))}
                     <div class="page-list" id="order_page">
                     </div>
						{/if}
                    </div>
                  <!--翻页 end-->
                  <div class="clear"></div>
                </div>
                <!--tc-li end-->
              </div>
			   <script>
                $(document).ready(function() {
					{if(!empty($list))}
					page("order_page","{$path}",{$num},{$list->page},{$list->total});
					{/if}
                });
                </script>
          </div>
          <!--con end-->

        </div>
        <!--right start-->
      </div>
</div>
</section>
<!--studentPortal end-->
<div id="rightWindow"></div>
<script>$("#rightWindow").load("/org.rightWindow.rightWindow");</script>
{part "/site.main.footer"}
</body>
</html>
<script>
$(function() {
	$(".cancel").click(function(){
		if(confirm("您确定要取消这个订单吗")){
			var orderid = $(this).attr("order_id");
			var order_status = 'cancel';
			$.post("/student.order.updateStatusAjax",{ order_id:orderid,status:order_status },function(r){
				if(r.error){
					alert(r.error);
					return false;
				}else{
		    		location.reload();
					return false;
                }
			},"json");
		}
        return false;
	});

    $(".delete").click(function(){
		if(confirm("您确定要删除这个订单吗")){
			var orderid = $(this).attr("order_id");
			var order_status = 'deleted';
            $.post("/student.order.updateStatusAjax",{ order_id:orderid,status:order_status },function(r){
				if(r.error){
					alert(r.error);
	    			return false;
				}else{
		 			location.reload();
                    return false;
	  			}
	  		},"json");
        }
	  	return false;
    });

	$('#tabCon .tc-li').first().show();
	$('.list-tab>dd').click(function() {
	    $(this).addClass('curr').siblings().removeClass('curr');
	    $('#tabCon>.tc-li:eq(' + $(this).index() + ')').show().siblings().hide();
	});

});
var order_timers = [];
function ts(SysSecond,thisid,orderid) {
   var SysSecond,InterValObj,sec,min,s,this_id;
        this_id=$('#'+thisid);
        min=SysSecond.split(':')[0];
        sec=SysSecond.split(':')[1];
        s=parseInt(min*60)+parseInt(sec);
        InterValObj = window.setInterval(SetRemainTime, 1000);
        function SetRemainTime() {
            if (s > 0) {
                s = s - 1;
                var second = Math.floor(s % 60);
                var minite = Math.floor(s / 60);
                this_id.find('.cYellow').text(minite + ":" + second);
            } else {
                window.clearInterval(InterValObj);
				$.post("/student.order.updateStatusAjax",{ order_id:orderid,status:'expired' },function(r){
					if(r.error){
				    	alert(r.error);
				        return false;
				    }
				    if(r){
                		this_id.find('.oltc-3').html('超时失效');
                		var this_href=$(this_id).find('.pic a').attr('href');
						var content = '<a class="btn_yellow_2_1" href="'+this_href+'" target="_blank">重新购买</a>'+
						              '<p class="mt10"><a href="javascript:;" class="delete" order_id="'+orderid+'">删除订单</a></p>';
                		this_id.find('.oltc-4').html(content);
                     }
                 },"json");
            }
        }
}
</script>

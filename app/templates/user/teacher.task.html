<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>高能100 - 作业列表</title>
{part "/index.main.headeruser"}
<script src="{utility_cdn::js('/assets/js/part.js')}"></script>
    </head>
<style> 

        .user_content_box{ height: 1200px;  }
        .user_content_box .jpas{ margin-top: 25px;margin-left: 30px; }
        .user_content_box .jpas .header-tou{ height: 35px;width: 200px; float: left; }
        .user_content_box .jpas .header-tou .hea-left p{ line-height: 35px;font-size: 16px; }
        .user_content_box .jpas .header-tou .hea-left img{ float: left;margin: 13px 10px 0px 15px; }
        .user_content_box .jpas .header-tou .hea-right{ float: right;margin:-25px 10px 0 0;color: #f00; }
        .user_content_box .gl{ height: 40px; margin-top: 10px;margin-right: 10px; }
        .user_content_box .gl select{ width: 150px;height: 34px;padding-left:10px;float: right }
        .user_content_box .tbl-t{ padding:0 16px 0 0;margin-top: 20px; }
        .user_content_box .tbl-t th{ text-align: center; color:#999999; }
        .user_content_box .tbl-t td{ border: 1px solid #f7f7f7;height: 75px;border-top: none;border-left: none;line-height: 25px;width: 150px;text-align: center; }
        .user_content_box .tbl-t td b{ color: #FEA81F; font-weight: normal; }
        .user_content_box .tbl-t td img{ cursor: pointer; }
        .user_content_box .tbl-t .weid{ width:330px;color:#3465CE;cursor: pointer; }
        .user_content_box .tbl-t .weid1 img{ cursor: pointer; }
        .user_content_box .tbl-t .header{ background: #f7f7f7;height: 40px; }
        .user_content_box .jpas-1{ width: 652px;height:300px;border: 1px solid #ccc; margin-top: 25px;margin-left: 30px; }
        .user_content_box .jpas-1 .header-tou{ height: 35px;background:#f7f7f7; }
        .user_content_box .jpas-1 .header-tou .hea-left p{ line-height: 35px;font-size: 16px; }
        .user_content_box .jpas-1 .header-tou .hea-left img{ float: left;margin: 13px 10px 0px 15px; }
        .user_content_box .jpas-1 .name{ margin-left: 100px;margin-top: 20px; }
        .user_content_box .jpas-1 .name .yjname input{ width: 453px;height: 35px;padding:10px;border: 1px solid #e4e4e4; }
        .user_content_box .jpas-1 .name .btnname input{ width: 453px;height: 35px;margin-top:5px;background: #FFF8EE;border:1px solid #FEA81D;color: #FFB473; }
        .user_content_box .jpas-1 .name .te1{ position: relative; }
        .user_content_box .jpas-1 .name .te1 .te2{ position: absolute;top:60%;right:20%; }
        .user_content_box .jpas-1 .name .te1 .te2 input{ width: 60px;height: 27px;background:#FEA91B;border:none;border-radius: 5px;color: #f4f4f4; }
        .user_content_box .jpas-1 .name .te1 textarea{ width: 454px;height: 107px; margin-top:5px;border: 1px solid #e4e4e4; } 
</style>
<body>
  <!--top-->
     {part "/index.main.nav.user"}
<div class='count'>
  <div class='container-fluid'>
    <div class='row'>
      <div class='col-md-3 user_menu hidden-xs'>
        <div id=''>
          <div id='menu'>
             {part "/user.home.menu.user"}

          </div>
        </div>
      </div>
      <div class='col-md-9 user_content'>
        <div class='user_box'>
          <div class='container-fluid'>
            <div class='row'>
              <div class='user_content_box'>
                 <div class='jpas'>
                    <div class='header-tou'>
                      <div class='hea-left'><img src="{utility_cdn::img('/assets/images/yjzy.jpg')}" alt=""><p>所有课程</p></div>
                    </div>
                    <div class='gl'>
                        <select name="course" id="course">
                            <option value="">作业管理</option>
                            <option value="/user.teacher.reply">学生作业</option>
                        </select>
                    </div>
                 </div> 
               <div class='tbl-t'>
                   <table>
                    {if !empty($list->data)}
                     <tr class='header'>
                      <th>作业名称</th>
                      <th>班级</th>
                      <th>完成人数</th>
                      <th>分发作业</th>
                      <th>编辑</th>
                      <th>删除</th>
                    </tr>
                    {foreach $list->data as $t}
                    <tr>
                      <td><a href="/user.teacher.reply.{$t->pk_task}" class='weid'>{$t->title}</a></td>
                      <td>{$t->class_name}</td>
                      <td><b>{if !empty($count1[$t->pk_task])}{$count1[$t->pk_task]}{else}0{/if}</b>/{if !empty($count2[$t->fk_course])}{$count2[$t->fk_course]}{else}0{/if}</td>
                      <td class='weid1' tid="{$t->pk_task}"><a class="send" href="#">分发</a></td>
                      <td class='weid1' tid="{$t->pk_task}"><img class="edit" src="{utility_cdn::img('/assets/images/book.png')}" alt=""></td>
                      <td class='weid1' tid="{$t->pk_task}"><img src="{utility_cdn::img('/assets/images/stop.png')}" class="remove" alt=""></td>
                    </tr>
                    {/foreach}
                    {else}
                    <tr>
                      <td>暂无作业</td>
                    </tr>
                    {/if}
                 </table>
               </div>
               <div id="task_add" class='jpas-1'>
                 <form id="form_add" class="form-horizontal" role="form">
                  <div class='header-tou'>
                    <div class='hea-left'><img src="{utility_cdn::img('/assets/images/yjzy.jpg')}" alt=""><p>布置作业</p></div>
                  </div>
                  <div class='name'>
                    <div class='yjname'>
                        <input type="text" name="title" placeholder='作业名称'>
                    </div>
                    <div class='btnname'>
                       <div id="filelist1"></div>
                       <input type="hidden" class="fid" name="fid">
                       <div id="container1">
                       <input id="browse1" type="button" value="选择附件" />
                       <input id="uploadfiles1" type="button" value="开始上传" />
                       </div>
                    </div>
                    <script src="{utility_cdn::js('/assets/js/plupload/js/plupload.full.min.js')}"></script>
                    <script>
                    $(document).ready(function(){
                        var fid='';
                        var uploader = new plupload.Uploader({
                            browse_button: 'browse1', // this can be an id of a DOM element or the DOM element itself
                            container: document.getElementById('container1'),
                            url: '/file.main.uploadTaskFiles.3',
                            filters: {
                                mime_types : [],
                                max_file_size:"2000kb"
                            },
                            init: {
                                PostInit: function() {
                                    document.getElementById('filelist1').innerHTML = '';

                                    document.getElementById('uploadfiles1').onclick = function() {
                                        uploader.start();
                                        return false;
                                    };
                                },

                                FilesAdded: function(up, files) {
                                    plupload.each(files, function(file) {
                                        document.getElementById('filelist1').innerHTML += '<div id="' + file.id + '">' + file.name + ' (' + plupload.formatSize(file.size) + ') <b></b></div>';
                                    });
                                },

                                UploadProgress: function(up, file) {
                                    document.getElementById(file.id).getElementsByTagName('b')[0].innerHTML = '<span>' + file.percent + "%</span>";
                                },

                                Error: function(up, err) {
                                    document.getElementById('console').innerHTML += "\nError #" + err.code + ": " + err.message;
                                }
                            },
                            resize: { width: 320, height: 240, quality: 90 },
                            multi_selection:false
                        });
                        uploader.init();

                        uploader.bind('FileUploaded', function(up, file,info) {
                            $("#uploadfiles").val("上传完成");
                            if(info.response){
                                var r = jQuery.parseJSON(info.response);
                                if(r && r.fid){
                                    fid+=r.fid+'|';
                                    $("#form_add").find(".fid").val(fid);
                                    return;
                                }
                                alert("上传失败");
                            }
                        });
                        $("#form_add").submit(function(){
                            $.post("/user.teacher.addTaskAjax",$(this).serialize(),function(r){
                            if(r.error){
                                alert(r.error);
                                if(r.field){
                                    $("[name="+r.field+"]").focus();
                                }
                                return false;
                            }
                            if(r){
                                location.reload();
                                return false;
                            }
                            },"json");
                            return false;
                        });
                    });
                    </script>
                    <div class='te1'>
                           <textarea name="desc" class="desc" cols="30" rows="10"></textarea>
                           <div class='te2'>
                            <input type="hidden" name="tid">
                            <input type="hidden" name="pid" value="{$pm['plan']}">
                            <input type="submit" value='发送'>
                           </div>
                    </div>
                  </div> 
                 </form>
               </div>   
               <div id="task_edit" class='jpas-1' style="display:none;">
                 <form id="form_edit" class="form-horizontal" role="form">
                  <div class='header-tou'>
                    <div class='hea-left'><img src="{utility_cdn::img('/assets/images/yjzy.jpg')}" alt=""><p>修改作业</p></div>
                  </div>
                  <div class='name'>
                    <div class='yjname'>
                        <input type="text" name="title" value='作业名称'>
                    </div>
                    <div class='btnname'>
                       <div id="filelist"></div>
                       <input type="hidden" class="fid" name="fid">
                       <div id="container">
                       <input id="browse" type="button" value="选择附件" />
                       <input id="uploadfiles" type="button" value="开始上传" />
                       </div>
                    </div>
                    <script src="{utility_cdn::js('/assets/js/plupload/js/plupload.full.min.js')}"></script>
                    <script>
                    $(document).ready(function(){
                        var fid='';
                        var uploader = new plupload.Uploader({
                            browse_button: 'browse', // this can be an id of a DOM element or the DOM element itself
                            container: document.getElementById('container'),
                            url: '/file.main.uploadTaskFiles',
                            filters: {
                                mime_types : [],
                                max_file_size:"2000kb"
                            },
                            init: {
                                PostInit: function() {
                                    document.getElementById('filelist').innerHTML = '';

                                    document.getElementById('uploadfiles').onclick = function() {
                                        uploader.start();
                                        return false;
                                    };
                                },

                                FilesAdded: function(up, files) {
                                    plupload.each(files, function(file) {
                                        document.getElementById('filelist').innerHTML += '<div id="' + file.id + '">' + file.name + ' (' + plupload.formatSize(file.size) + ') <b></b></div>';
                                    });
                                },

                                UploadProgress: function(up, file) {
                                    document.getElementById(file.id).getElementsByTagName('b')[0].innerHTML = '<span>' + file.percent + "%</span>";
                                },

                                Error: function(up, err) {
                                    document.getElementById('console').innerHTML += "\nError #" + err.code + ": " + err.message;
                                }
                            },
                            resize: { width: 320, height: 240, quality: 90 },
                            multi_selection:false
                        });
                        uploader.init();

                        uploader.bind('FileUploaded', function(up, file,info) {
                            $("#uploadfiles").val("上传完成");
                            if(info.response){
                                var r = jQuery.parseJSON(info.response);
                                if(r && r.fid){
                                    fid+=r.fid+'|';
                                    $("#form_edit").find(".fid").val(fid);
                                    return;
                                }
                                alert("上传失败");
                            }
                        });
                        $("#form_edit").submit(function(){
                            $.post("/user.teacher.updateTaskAjax",$(this).serialize(),function(r){
                            if(r.error){
                                alert(r.error);
                                if(r.field){
                                    $("[name="+r.field+"]").focus();
                                }
                                return false;
                            }
                            if(r){
                                location.reload();
                                return false;
                            }
                            },"json");
                            return false;
                        });
                    });
                    </script>
                    <div class='te1'>
                           <textarea name="desc" class="desc" cols="30" rows="10"></textarea>
                           <div class='te2'>
                            <input type="hidden" name="tid">
                            <input type="submit" value='发送'>
                           </div>
                    </div>
                  </div> 
                 </form>
               </div>   
                 
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>
{part "/index.main.footer"}
</body>
<script>
$(document).ready(function(){
    $('#course').change(function(){
        var p=$(this).children('option:selected').val();
        window.location.href=p;
    });
    $(".send").click(function(){
        if(confirm("您确定要分发作业吗？")){
            var tid = $(this).parents("td").attr("tid");
            $.post("/user.teacher.sendTaskAjax","tid="+tid,function(r){
                if(r.error){
                    alert($r.error);
                }else{
                    alert('分发成功');
                }
            },"json");
        }
        return false;
    });
    $(".remove").click(function(){
        if(confirm("您确定要删除这份作业吗？")){
            var tid = $(this).parents("td").attr("tid");
            $.post("/user.teacher.delTaskAjax","tid="+tid,function(r){
                if(r.error){
                    alert($r.error);
                }else{
                    location.reload();
                }
            },"json");
        }
        return false;
    });
    $(".edit").click(function(){
        //console.log($(this).parents("td").attr("nid"));
        var tid=$(this).parents("td").attr("tid");
        $.post("/user.teacher.getTaskAjax","tid="+tid,function(data){
            var el = $("#task_edit");
            if (data && data.data) {
                data = data.data;
                $(el).find("input[name=title]").val(data.title)
                $(el).find("input[name=tid]").val(tid)
                $(el).find(".desc").html(data.desc)
            } else {
                alert('获取失败!');
            }
        },"json");
        $("#task_add").hide();
        $("#task_edit").show();
    });
});
</script>
</html>

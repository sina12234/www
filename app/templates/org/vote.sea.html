<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>{$info['title']}-【{$orgName}】小伙伴，我正在参与投票。快来参加吧！</title>
<meta name="title" content="{part '/site.main.orgname'} - 资料信息 - 云课 - 专业的在线学习平台">
<meta name="keywords" content="{part '/site.main.orgname'} - 云课 - Yunke K12 在线学习 直播 云课网 在线教育">
<meta name="description" content="{part '/site.main.orgname'} - 云课(Yunke.com) -专业的K12在线学习平台。以直播授课为核心，打破时间与空间的界限，为教师高效教学、学生高效学习、家长高效管控及机构高效管理提供完美解决方案">
{part "/site.main.header"}
<style>
.vote_cent li .tea_p a{ position: relative;}
.video_pic{ width: 58px;height: 58px;display: inline-block;background: url("{utility_cdn::img('/assets_v2/img/vieo_h.png')}") no-repeat;position: absolute;top: 50%;left: 50%;margin-left: -30px;margin-top: -30px; }
.share-sns{ background: #fff;}
</style>
</head>
<body>
{part "/site.main.nav"}
<div class="box_bg">
	<div class="container">
		<div class="col-md-20 vote_cont pd0">
			<div class=" vote_auto">
				<!--top-->
				<div class="vote_top">
					<span class=" tit col-md-10 col-md-offset-5">
						<h2 class="">{$info['title']}
						{if $info['proceedType'] == 1 && $info['status'] != -1}
							<em class="">{$info['proceed']}</em>
						</h2>
						{/if}
						<h3 class="clear"><span>{'发起人'|tr:'org'}：{$info['userName']}</span><span>{'开始日期'|tr:'org'}：{$info['startTime']}</span></h3>
					</span>

					{if($info['proceedType'] == 2)}
					<!--已结束-->
					<span class="col-md-5 end_data">
						<p >{'倒计时'|tr:'org'}</p>
						<span><em class="t_d"></em>&nbsp;{'天'|tr:'org'}&nbsp;<em class="t_h"></em>&nbsp;{'时'|tr:'org'}&nbsp;<em class="t_m"></em>&nbsp;{'分'|tr:'org'}&nbsp;<em class="t_s"></em>&nbsp;{'秒'|tr:'org'}&nbsp;</span>
					</span>
					{elseif $info['status'] == -1}
					<span class="col-md-5 end_data">
						<p >{'倒计时'|tr:'org'}</p>
						<span><em class="t_d">00</em>&nbsp;{'天'|tr:'org'}&nbsp;<em class="t_h">00</em>&nbsp;{'时'|tr:'org'}&nbsp;<em class="t_m">00</em>&nbsp;{'分'|tr:'org'}&nbsp;<em class="t_s">00</em>&nbsp;{'秒'|tr:'org'}&nbsp;</span>
					</span>
					{elseif $info['proceedType'] == 3}
					<span class="col-md-5 data">
						<p >{'距离开始时间'|tr:'org'}</p>
						<span><em class="t_d"></em>&nbsp;{'天'|tr:'org'}&nbsp;<em class="t_h"></em>&nbsp;{'时'|tr:'org'}&nbsp;<em class="t_m"></em>&nbsp;{'分'|tr:'org'}&nbsp;<em class="t_s"></em>&nbsp;{'秒'|tr:'org'}&nbsp;</span>
					</span>
					{else}
					<span class="col-md-5 data">
						<p >{'倒计时'|tr:'org'}</p>
						<span><em class="t_d"></em>&nbsp;{'天'|tr:'org'}&nbsp;<em class="t_h"></em>&nbsp;{'时'|tr:'org'}&nbsp;<em class="t_m"></em>&nbsp;{'分'|tr:'org'}&nbsp;<em class="t_s"></em>&nbsp;{'秒'|tr:'org'}&nbsp;</span>
					</span>
					{/if}
					
					{if !empty($info['descript'])}
					<div class="clear">
						<p class="title">{$info['descript']}</p>
					</div>
					{/if}
					<ul class="vote_pic layer-area">
						{if !empty($info['thumb'])}
						<li class="col-md-5 col-sm-10 col-md-10 col-xs-10 pdl0"><img src="{$info['thumb']}"></li>
						{/if}
						{if !empty($info['thumb1'])}
						<li class="col-md-5 col-sm-10 col-md-10 col-xs-10 pdl0"><img src="{$info['thumb1']}"></li>
						{/if}
						{if !empty($info['thumb2'])}
						<li class="col-md-5 col-sm-10 col-md-10 col-xs-10 pdl0"><img src="{$info['thumb2']}"></li>
						{/if}
					</ul>
					<div class="state">
						{if $info['proceedType'] == 3 && $info['status'] == 1}
							<!--未开始-->
							<img src="{utility_cdn::img('/assets_v2/img/not_beggin.png')}" />
						{elseif $info['proceedType'] == 2 && $info['status'] == 1}
							<!--已结束-->
							<img src="{utility_cdn::img('/assets_v2/img/end_pic.png')}" />
						{elseif $info['status'] == -1}
							<!--已删除-->
							<img src="{utility_cdn::img('/assets_v2/img/delect_pic.png')}" />
						{/if}
					</div>
				</div>
				<!--center-->
				<div class="col-md-20 col-md-offset-0 clear vote_cent mt20 pd0">

                    {if $info['objectType'] == 1}
					<ul class="vote_ul">
						{if !empty($optionData)}
						{foreach $optionData as $v}
						<li class="col-md-5 col-sm-10 col-md-10 col-xs-10 pdl0" siteId="{$v->pk_option}">
							{if !empty($v->thumbDisplay)}
							<div class="tea_p">
								<a href="{$v->url}" target="_blank">
									<img src="{$v->thumbDisplay}" />
									<span class="span_p length_sl">{$v->name_display}</span>
								</a>
                                <a class="info-bor" href="/teacher/detail/entry/{$v->teacherId}" target="_blank">
                                    <span class="c-fl"><img class="c-fl"  src="{utility_cdn::file($v->teacherThumb)}"></span>
                                    <span class="c-fl mt5"><b class="fs12">{$v->teacherName}</b></span>
                                </a>
								<span class=" bar_num">{$v->order_no}</span>
							</div>
							{/if}
							{if $info['type']==2 or $isVote==1}
							    <div class="bar">
									<span class="col-md-20 bar_r"><em>{$v->total_count}{'票'|tr:'org'}</em></span>
									<span class="bar_r bfb" style="width:{$v->preVoteCount}%;"></span>
							    </div>
							{/if}
                            {if $info['status']>0 && $v->isOption>=0}
								{if $v->isOption==1 }
									<div class="circle tea_pic choice_h"></div>
								{/if}
								{if $isVote!=1}
									{if ($info['proceedType']==1)}
									<div class="choice tea_pic circle"></div>
									{/if}
								{/if}
							{/if}
						</li>
						{/foreach}
						{/if}
					</ul>
                    {elseif $info['objectType'] == 2}
                    <!--老师-->
					<ul class="vote_ul voteT_ul">
						{if !empty($optionData)}
						{foreach $optionData as $v}
						<li class="col-md-5 col-sm-10 col-md-10 col-xs-10 pdl0" siteId="{$v->pk_option}">
							<div class="tea_p">
								<div class="teah_pic">
                                <a href="{$v->url}" target="_blank">
									<img  src="{$v->thumbDisplay}" />
                                </a>
								</div>
								<a href="{$v->url}" target="_blank">
									<span class="span_p length_sl">{$v->name_display}</span>
									<!--<span class="span_p length_sl span_p2">{$v->teacherTitle}</span>-->
								</a>
								<span class=" bar_num">{$v->order_no}</span>
							</div>
							<div class="bar">
									{if $info['type'] == 2 or $isVote==1}
										<span class="col-md-12 bar_r"><em>{$v->total_count}票</em></span>
										<span class="bar_r bfb" style="width:{$v->preVoteCount}%;"></span>
									{/if}
							</div>
                            {if $info['status']>0 && $v->isOption>=0}
								{if $v->isOption==1}
									<div class="circle tea_pic choice_h"></div>
								{/if}
								{if $isVote!=1}
									{if ($info['proceedType']==1)}
									<div class="choice tea_pic circle"></div>
									{/if}
								{/if}
							{/if}
						</li>
						{/foreach}
						{/if}
					</ul>
                    {else}
                    <!--章节-->
				<ul class="vote_ul">
						{if !empty($optionData)}
						{foreach $optionData as $v}
						<li class="col-md-5 col-sm-10 col-xs-10 pdl0" siteId="{$v->pk_option}">
							<div class="tea_p">
								<a href="{$v->url}" target="_blank">
									<img class="tea_pic" src="{$v->thumbDisplay}" />
									{if $v->status==3}
									<em class="video_pic"></em>
									{/if}

									<span class="span_p length_sl" style="margin-top: -2px;">{$v->courseName}
										<p>{$v->className}
											<em style="padding-left:10px">{$v->planName}</em></p>
									</span>
									<a href="/teacher/detail/entry/{$v->teacherId}" target="_blank" class="info-bor">
                                        <span class="c-fl"><img class="c-fl" src="{utility_cdn::file($v->teacherThumb)}"></span>
                                        <span class="c-fl"><b class="fs12">{$v->teacherName}</b></span>
                                    </a>
								</a>
								<span class="bar_num">{$v->order_no}</span>
							</div>
							<div class="bar">
									{if $info['type'] == 2 or $isVote==1}
										<span class="col-md-12 bar_r"><em>{$v->total_count}票</em></span>
										<span class="bar_r bfb" style="width:{$v->preVoteCount}%;"></span>
									{/if}
							</div>
                            {if $info['status']>0 && $v->isOption>=0}
								{if $v->isOption==1}
									<div class="circle tea_pic choice_h"></div>
								{/if}
								{if $isVote!=1}
									{if ($info['proceedType']==1)}
									<div class="choice tea_pic circle"></div>
									{/if}
								{/if}
							{/if}
						</li>
						{/foreach}
						{/if}
					</ul>
                    {/if}

					<!--
					<p class="col-md-12 total">已投{$info['totalCount']}票</p>
					-->
					<!--已投票-->
					{if $isVote==1}
						<div class="col-md-20 col-sm-20  vote_but c-fl not_but clear"><a href="javascript:return false;" >{'已投票'|tr:'org'}</a>
							<span class="chk">{if ($info['selectCount'] > 1) }
								{'多选'|tr:'org'} ({'最多选'|tr:'org'} {$info['selectCount']} {'项'|tr:'org'})
								{else}
								{'单选'|tr:'org'}
								{/if}
							</span>
						</div>
					{elseif $info['proceedType']==3}
					<!--投票未开始-->
						<div class="col-md-20 col-sm-20  vote_but c-fl not_but clear"><a href="javascript:return false;" >{'未开始'|tr:'org'}</a>
							<span class="chk">{if ($info['selectCount'] > 1) }
								{'多选'|tr:'org'} ({'最多选'|tr:'org'} {$info['selectCount']} {'项'|tr:'org'})
								{else}
								{'单选'|tr:'org'}
								{/if}
							</span>
						</div>
					{elseif $info['proceedType']==2}
					<!--投票已结束-->
                    	<div class="c-fl col-md-20 col-sm-20  vote_but not_but clear"><a href="javascript:return false;" >{'已结束'|tr:'org'}</a>
							<span class="chk">{if ($info['selectCount'] > 1) }
								{'多选'|tr:'org'} ({'最多选'|tr:'org'} {$info['selectCount']} {'项'|tr:'org'})
								{else}
								{'单选'|tr:'org'}
								{/if}
							</span>
						</div>
					{elseif $info['status'] == -1}
						<div class="c-fl col-md-20 col-sm-20  vote_but not_but clear"><a href="javascript:return false;" >{'已删除'|tr:'org'}</a>

							<span class="chk">{if ($info['selectCount'] > 1) }
								{'多选'|tr:'org'} ({'最多选'|tr:'org'} {$info['selectCount']} {'项'|tr:'org'})
								{else}
								{'单选'|tr:'org'}
								{/if}
							</span>
						</div>
					{else}
					<!--投票前 -->
						<div class="c-fl col-md-20 col-sm-20  vote_but"><a href="javascript:;" id="vote();">{'投票'|tr:'org'}</a>

							<span class="chk">{if ($info['selectCount'] > 1) }
								{'多选'|tr:'org'} ({'最多选'|tr:'org'} {$info['selectCount']} {'项'|tr:'org'})
								{else}
								{'单选'|tr:'org'}
								{/if}
							</span>
						</div>
					{/if}
					<div class="vote_bot clear col-md-20 mt20">
						<span class="col-md-20 col-md-offset-10"><em class="fl">{'分享给好友'|tr:'org'}：</em>
							<div class="share-sns fl">
                                <a href="javascript:;" class="share-qq" data-cmd="tqq" title="{'分享到QQ'|tr:'org'}"></a>
                                <a href="javascript:;" class="share-weixin" data-cmd="weixin" title="{'分享到微信'|tr:'org'}"></a>
                                <a href="javascript:;" class="share-tsina" data-cmd="tsina" title="{'分享到新浪微博'|tr:'org'}"></a>
							</div>
							   <script>

								   $(function(){
									   var t = "{$info['title']}";
									   var orgName = "{$orgName}";
									   var vid = {$info['voteId']};
									   var voteImg = '{$voteImg}';

									   $(".share-sns").share({
										   sTitle:''+t+''+orgName,
										   sPic:voteImg,
                                           sDes:'小伙伴，我正在参与投票。快来参加吧，投上你宝贵的一票！'
									   });
									   $(".share-sns a").click(function(){
										   $.post("/org/poll/StatShare",{ voteId:vid },function(r){
											   console.log(r);
										   });
									   });
								   })

							   </script>
						</span>
						<!--<span class="col-md-2 share_l">{'地址'|tr:'org'}：</span>-->
						<!--<input type="text" class="col-md-4" placeholder="" value="{$url}">-->

					</div>
				</div>
				<!--button-->

			</div>
		</div>
	</div>
</div>
{part "/site.main.footer"}
<script src="{utility_cdn::js('/assets_v2/js/jquery.share.js')}"></script>
</body>
<script>
	var isVote      = {$isVote};
	var proceedType = {$info['proceedType']};
	var status      = {$info['status']};
	//适配
	if($(window).width()<768){
		$('.end_data').hide();
	}
	if($(window).width()>1025){
		$('.end_data').show();
	}
	//图片点击放大
	$(".vote_pic li").click(function(){
		var sImg=$(this).find("img").attr("src");
		layer.open({
			type: 1,
			title: false,
			closeBtn: 0,
			area: ['auto', 'auto'],
			skin: 'layui-layer-nobg', //没有背景色
			shadeClose: true,
			content: "<img src="+sImg+">"
		});
	});
	var siteId=[];

	$(".vote_ul li").on('click',".tea_pic",function(){
		if(isVote || proceedType !=1 || status == -1) {
			return false;
		}
			var maxVote = {$info['selectCount']};
			var choice_l=$(".vote_ul li").find(".choice_h").length+1;
			var _this=$(this);
			var siteid=_this.parents("li").attr("siteId");
			if(_this.parents("li").find(".circle").hasClass("choice")){
					if(choice_l<=maxVote){
						siteId.push(siteid);
						siteId=$.unique(siteId);
						_this.parents("li").find(".circle").removeClass("choice").addClass("choice_h");
					}else{
                        layer.msg("{'最多选'|tr:'org'} "+maxVote+" {'项'|tr:'org'}");
						return false;
					}
			}else{
				var nIndex=$.inArray(siteid,siteId);
				if(nIndex>=0){
					siteId.splice(nIndex,1);
				}
				_this.parents("li").find(".circle").removeClass("choice_h").addClass("choice");
			}
	});
	
	$(".vote_but a").click(function(){
		if(isVote || proceedType !=1 || status == -1 ) {
			return false;
		}
		var userId = {$uid};
		var voteId = {$info['voteId']};
		if(checkLogin()){
			$.post("/org.poll.VoteAjax",{ voteId:voteId ,siteId:siteId, userId:userId },function(r){
				if(r.code == 1){
					layer.msg(r.msg);
					location.reload();
				}else{
					layer.msg(r.msg);
				}
			},'json');
		}
	})
	
	function checkLogin(){
		var isLogin = {$uid},w,h;
		var urlId={$info['voteId']};
		if($(window).width()>800){
			w='476px';
			h='283px';
		}else{
			w='90%';
			h='283px';
		}
		if(isLogin==0){
			if($(window).width()>768){
				layer.open({
					type: 2,
					title: ['登录','color:#fff;background:#ffa81d'],
					area: [w,h],
					shadeClose: true,
					content: ['/org.poll.userLogin']
				});
			}else{

				location.href='/site.main.login?url=/org/poll/info/'+urlId;
			}
			return false;
		}
		return true;
	}
	
	//倒计时
	var sTime;
	var st;
	var sdata= "{$info['endTime']}";
	function getRTime(){
		var EndTime= new Date(sdata); //截止时间

		var NowTime = new Date();
		 st =EndTime.getTime() - NowTime.getTime();
		if(st>0){
			var d=Math.floor(st/1000/60/60/24);
			var h=Math.floor(st/1000/60/60%24);
			var m=Math.floor(st/1000/60%60);
			var s=Math.floor(st/1000%60);
			
			$(".data .t_d").text(d);//天
			$(".data .t_h").text(h);//时
			$(".data .t_m").text(m)//分
			$(".data .t_s").text(s)//秒
		}
		else{
			$(".data .t_d").text(00);//天
			$(".data .t_h").text(00);//时
			$(".data .t_m").text(00)//分
			$(".data .t_s").text(00)//秒
			window.clearInterval(sTime);
		}

	}
	sTime=setInterval(getRTime,1000);
</script>
</html>

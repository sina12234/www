<!DOCTYPE html>
<html>
<head>
<title>退费申请 - {part '/site.main.orgname'} - 云课 - 专业的在线学习平台</title>
<meta name="title" content="{part '/site.main.orgname'} - 机构中心 - 云课 - 专业的在线学习平台">
<meta name="keywords" content="{part '/site.main.orgname'} - 云课 - Yunke K12 在线学习 直播 云课网 在线教育">
<meta name="description" content="{part '/site.main.orgname'} - 云课(Yunke.com) -专业的K12在线学习平台。以直播授课为核心，打破时间与空间的界限，为教师高效教学、学生高效学习、家长高效管控及机构高效管理提供完美解决方案">
{part "/site.main.header"}
</head>
<body>
{part "/site.main.nav"}
<style type="text/css">
	.refund-apply{ width: 1200px;}
	.refund-apply .refund-apply-order-id{ background: #f7f7f7; line-height: 30px;width: 100%; border-top: 1px solid #e8e8e8;}
	.refund-apply .refund-apply-amount{ padding-bottom: 0;}
	.refund-apply .refund-apply-amount input{ content:'123'; }
	.refund-apply .refund-apply-discount{ text-decoration: line-through;}
	.bgf7{ background-color: #f7f7f7;}
	.bor1px{ border:1px solid #ddd;}
	.refund-apply .refund-apply-amount-num:focus{ border:1px solid #198fee;}
	.refund-apply .err .refund-apply-amount-num{ border:1px solid #f01400;}
	.refund-apply .refund-apply-amount .tips{ display: none;}
	.refund-apply .refund-apply-amount .err .tips{ display: block;}
	.refund-apply .refund-info{ padding-left: 85px;}
	.refund-apply i{ vertical-align:middle;}
	@media screen and (max-width:768px) {
	   .refund-apply{ width: 100%;}
	   .refund-apply-info{ padding-top:15px;}
	   .refund-apply-info p,.refund-apply .form{ margin-top:0!important;padding-left: 0!important;}
	   .refund-apply-info .mt30{ margin:15px 0!important;}
	   .refund-apply .refund-info{ padding:0;}
	}
</style>
<section class="pd40" id="refund">
	<div class="container refund-apply bgf fs14">
		<div class="row ml0 mr0">
			<div class="pb10" style="border-bottom: 1px solid #bbb;">
				<div class="mt30"><span>申请退费</span></div>
			</div>
			<div class="hidden-xs hidden-sm mt20 bor1px bgf7 pd10 clear tac lGray">
				<div class="col-sm-10">课程信息</div>
				<div class="col-sm-4">用户信息</div>
				<div class="col-sm-3">应交金额</div>
				<div class="col-sm-3">优惠情况</div>
			</div>
			<div class="refund-apply-info mt10 bor1px">
				<div class="clearfix tac">
					<div class=" col-xs-20 col-sm-10 tal p15">
						<div class=" col-xs-20 col-sm-10 col-md-6 c-fl pic p0">
							<a href="/course.info.show/{$orderInfo->object_id}">
								<img src="{$orderInfo->course['img']}" width="100%" alt="">
							</a>
						</div>
						<div class=" col-xs-20 col-sm-10 col-md-12 c-fl">
							<a href="/course.info.show/{$orderInfo->object_id}" class="cGray">
								<h1 class="lGray">{$orderInfo->course['name']}</h1>
								<p class="mt15">班级：<span>{$orderInfo->course['className']}</span></p>
								<p class="mt15">共{$orderInfo->course['planNum']}节&nbsp;&nbsp;已学{$orderInfo->course['progress']}节</p>
							</a>
						</div>
					</div>
					<div class=" col-xs-8 col-sm-4 mt30">
						<p class="col-xs-20 col-sm-20 lGray">{$orderInfo->stuName}</p>
						<p class="col-xs-20 col-sm-20 lGray">{$orderInfo->mobile}</p>
					</div>
					<div class=" col-xs-6 col-sm-3 mt30">
						<p class=" col-xs-20 col-sm-20 theme-text">￥{$orderInfo->price}</p>
						<p class=" col-xs-20 col-sm-20 refund-apply-discount cGray">{if $orderInfo->price_old!=$orderInfo->price && $orderInfo->change_status==1}￥<var class="fs_dsc">￥{$orderInfo->price_old}</var>{/if}</p>
					</div>
					<div class=" col-xs-6 col-sm-3 mt30 cGray">
						<p class="col-xs-20 col-sm-20">{if $orderInfo->discount_status == 0}无
							{else}
							￥{$orderInfo->disPrice}
							{/if}</p>
						<p class="col-xs-20 col-sm-20">{$orderInfo->discount}</p>
					</div>
				</div>
				<div class="refund-apply-order-id pl15">
					<span>订单ID：{$orderInfo->orderSn}</span>
				</div>
			</div>
			<ul class="form fs14 mt30 form-horizontal pl20">
				<li class="form-group refund-apply-amount">
					<div class="control-label c-fl"><em class="cRed">*</em>退款金额：</div>
					<div class="label-for col-xs-20 col-sm-10 tip">
						<input type="text" class="col-xs-10 col-sm-12 refund-apply-amount-num" id="refund-apply-amount-num" value="" placeholder="不能大于成交金额">
						<div class="tips col-xs-20 col-sm-8">
							<span class="tips-icon"></span>
							<span class="tips-text cRed">不能大于成交金额</span>
						</div>
					</div>
				</li>
				<li>
					<div class="refund-info"><i class="tips-orange-icon mr5"></i>{if $orderInfo->fk_clearing>0}该课程已结算，从可提现金额中提取{else}该课程未结算，从订单金额中提取{/if}</div>
				</li>
				<li class="form-group refund-apply-amount">
					<div class="control-label c-fl"><em class="cRed">*</em>退款原因：</div>
					<div class="label-for col-xs-20 col-sm-10 tip">
						<input type="text" class="col-xs-10 col-sm-12 refund-apply-reason" id="refund-apply-reason" value="" placeholder="不少于5个字">
						<div class="tips col-xs-20 col-sm-8">
							<span class="tips-icon"></span>
							<span class="tips-text cRed">请输入5-50个汉字</span>
						</div>
					</div>
				</li>
				<li>
					<div class="mt30 mb30 pd0 tac">
						<button class="btn fs16" id="refund-apply-submit">
						提交 </button>
					</div>
				</li>
			</ul>
		</div>
	</div>
</section>
<script type="text/javascript">
	(function($){
		var refundInput = $('#refund-apply-amount-num');
		var refundReason = $('#refund-apply-reason');
		var refundAmount = refundInput.parent();
		var errInfo = refundInput.next().find('.tips-text');
		var refundReasonA = refundReason.parent();
		var errInfoR = refundReason.next().find('.tips-text');
		refundInput.keyup(function(event) {
			valid();
		});
		refundReason.keyup(function(event) {
		    fluid();
		})
		$('#refund-apply-submit').click(function(event) {
			if(!valid()&&refundInput.val()&&!fluid()&&refundReason.val()){
				var orderId = {$orderInfo->fk_order};
				var price = refundInput.val();
				var refundWhy = $("#refund-apply-reason").val();
				$.post("/org.ajax.addOrderContentRefund",{ orderId:orderId,price:price,refundWhy:refundWhy },function(r){
					if(r.code==0){
						$("#refund_price").text(price);
						$("#refund").hide();
						$("#refund_return").show();
					} else if(r.code<0){
						layer.msg(r.msg);
					}else{
						layer.msg("申请失败");
					}
				},'json');
			}else{
				layer.msg('请核实填写信息');
				return false;
			}
		});
		function valid(){
			var v = refundInput.val();
			var res = hasErr(v);
			res[0]?refundAmount.addClass('err'):refundAmount.removeClass('err');
			errInfo.text(res[1]);
			return res[0];
		}
		function fluid(){
		    var R = refundReason.val();
		    var res = hasErrR(R);
            res[0]?refundReasonA.addClass('err'):refundReasonA.removeClass('err');
            errInfoR.text(res[1]);
            return res[0];
		}
		function hasErr(v){
			var t = '',max = {$orderInfo->price};
			if(v.toString().length == 0){
				return [false,''];
			};
			if(isNaN(v) || v<=0 || !/^\d+(\.\d?\d)?$/.test(v)){
				t = '请输入正确的数额';
			}else if(v>max){
				t = '不能大于成交金额';
			}
			return t.length>0?[true,t]:[false,''];
		}
		function hasErrR(v){
		    var t = '';
		    if(v.length == 0){
                t = '不能为空';
			}else if(v.length<5){
		        t = '不少于5个字符';
			}else if(v.length>50){
			    t = '不超过50个字符';
			}
            return t.length>0?[true,t]:[false,''];
		}
	})(jQuery);
</script>
<style type="text/css">
	.refund-apply-success{ width: 1200px;} 
    .refund-apply-success-main{ float:none;padding:80px 0;}
    .refund-apply-success-tip { border-bottom: 1px solid #bbb;}
    .refund-apply-success-tip .cGray{ position: absolute;top:100%;left:30px;}
    .refund-apply-success-info { margin-left:30%;}
    .refund-apply-success .success-green-icon{ vertical-align:middle;}
    @media screen and (max-width:768px) {
	   .refund-apply-success{ width: 100%;}
	}
</style>
<section class="pd40" style="display: none;" id="refund_return">
    <div class="container refund-apply-success">
        <div class="row bgf">
            <div class="pdb30 clear col-md-8 refund-apply-success-main container">
                <div class="refund-apply-success-tip pb30 clear tac">
                    <span class="cGreen fs22 tal pos-rel"><i class="success-green-icon mr5"></i>恭喜您，申请成功，请耐心等待审核
                    <span class="fs12 tal cGray mt5" style>2-5个工作日</span></span>
                    
                </div>
                <div class="col-md-10 clear pt30 refund-apply-success-info">
                    <p class="mt5">课程信息：</p>
                    <p class="mt20">{$orderInfo->course['name']} {$orderInfo->course['className']}</p>
                    <p class="mt5">退费金额：<span class="cRed">￥<em id="refund_price">400</em></span></p>
                </div>
                <div class="col-xs-20 tac pb30">
                    <a target="_blank" href="/org.settle.refund" class="fs14 tac mt40 btn">查看退费记录</a>
                </div>
            </div>
        </div>
    </div>
</section>
{part "/site.main.footer"}
</body>
</html>